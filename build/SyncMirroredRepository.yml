name: $(BuildDefinitionName)_$(date:yyMM).$(date:dd)$(rev:rrr)
parameters:
- name: "SourceToTargetBranch"
  type: object
  default:
    main: main
    staging: staging
    release: release

jobs:
- job: SyncMirror
  strategy:
    matrix: 
      ${{ each branches in parameters.SourceToTargetBranch }}:
        ${{ branches.key }}:
          SourceBranch: ${{ branches.key }}
          TargetBranch: ${{ branches.value }}
  dependsOn: []
  pool:
    vmImage: 'windows-latest'
  steps:
  - task: AzureKeyVault@1
    inputs:
      azureSubscription: 'DevHomeAzureServiceConnection'
      KeyVaultName: 'DevHomeKeyVault'
      SecretsFilter: 'GitHubPAT'
      RunAsPreJob: false
      
  - template: SyncMirror-Steps.yml
    parameters:
      SourceRepository: "https://$(GitHubPAT)@github.com/microsoft/DevHome.git"
      TargetBranch: $(TargetBranch)
      SourceBranch: $(SourceBranch)
